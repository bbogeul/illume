{"source":"__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;\nvar IronRouterMeta,\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty;\n\nIronRouterMeta = (function(superClass) {\n  extend(IronRouterMeta, superClass);\n\n  function IronRouterMeta(router) {\n    this.router = router;\n    IronRouterMeta.__super__.constructor.call(this, this.router);\n    this.router.onAfterAction((function(_this) {\n      return function() {\n        var links, ref, ref1, ref10, ref11, ref12, ref13, ref14, ref15, ref16, ref17, ref2, ref3, ref4, ref5, ref6, ref7, ref8, ref9, scripts, tags;\n        $('[data-link-name], [data-meta-name], [data-script-name]').remove();\n        tags = [];\n        if ((ref = _this.router) != null ? (ref1 = ref.options) != null ? ref1.meta : void 0 : void 0) {\n          tags.push(_this.router.options.meta);\n        }\n        if (((ref2 = _this.currentController) != null ? ref2.prototype : void 0) && _.has(_this.currentController.prototype, 'meta')) {\n          tags.push(_this.currentController.prototype['meta']);\n        }\n        if ((ref3 = _this.currentRoute) != null ? (ref4 = ref3.route) != null ? (ref5 = ref4.options) != null ? ref5.meta : void 0 : void 0 : void 0) {\n          tags.push(_this.currentRoute.route.options.meta);\n        }\n        if (tags.length) {\n          _this.addTag(tags);\n        }\n        links = [];\n        if ((ref6 = _this.router) != null ? (ref7 = ref6.options) != null ? ref7.link : void 0 : void 0) {\n          links.push(_this.router.options.link);\n        }\n        if (((ref8 = _this.currentController) != null ? ref8.prototype : void 0) && _.has(_this.currentController.prototype, 'link')) {\n          links.push(_this.currentController.prototype['link']);\n        }\n        if ((ref9 = _this.currentRoute) != null ? (ref10 = ref9.route) != null ? (ref11 = ref10.options) != null ? ref11.link : void 0 : void 0 : void 0) {\n          links.push(_this.currentRoute.route.options.link);\n        }\n        if (links.length) {\n          _this.addLink(links);\n        }\n        scripts = [];\n        if ((ref12 = _this.router) != null ? (ref13 = ref12.options) != null ? ref13.script : void 0 : void 0) {\n          scripts.push(_this.router.options.script);\n        }\n        if (((ref14 = _this.currentController) != null ? ref14.prototype : void 0) && _.has(_this.currentController.prototype, 'script')) {\n          scripts.push(_this.currentController.prototype['script']);\n        }\n        if ((ref15 = _this.currentRoute) != null ? (ref16 = ref15.route) != null ? (ref17 = ref16.options) != null ? ref17.script : void 0 : void 0 : void 0) {\n          scripts.push(_this.currentRoute.route.options.script);\n        }\n        if (scripts.length) {\n          return _this.addScript(scripts);\n        }\n      };\n    })(this));\n  }\n\n  IronRouterMeta.prototype.updateNode = function(type, name, values, isClosing) {\n    var attrName, content, element;\n    if (isClosing == null) {\n      isClosing = false;\n    }\n    if ($('head').has(type + '[data-' + type + '-name=\"' + name + '\"]')[0]) {\n      $(type + '[data-' + type + '-name=\"' + name + '\"]').remove();\n    }\n    if (isClosing) {\n      element = $('<' + type + ' data-' + type + '-name=\"' + name + '\"></' + type + '>');\n    } else {\n      element = $('<' + type + ' data-' + type + '-name=\"' + name + '\" />');\n    }\n    for (attrName in values) {\n      content = values[attrName];\n      if (_.isFunction(content)) {\n        content = content.call(this.currentRoute);\n      }\n      if (content) {\n        element.attr(attrName, content);\n      }\n    }\n    return $('head').prepend(element);\n  };\n\n  IronRouterMeta.prototype._prepare = function(settings) {\n    var _settings, i, len, set;\n    _settings = {};\n    for (i = 0, len = settings.length; i < len; i++) {\n      set = settings[i];\n      if (_.isFunction(set)) {\n        _settings = _.extend(_settings, set.call(this.currentRoute));\n      } else if (_.isObject(set)) {\n        _settings = _.extend(_settings, set);\n      }\n    }\n    return _settings;\n  };\n\n  IronRouterMeta.prototype.addTag = function(settings) {\n    var _settings, name, results, values;\n    _settings = this._prepare(settings);\n    results = [];\n    for (name in _settings) {\n      values = _settings[name];\n      if (_.isFunction(values)) {\n        values = values.call(this.currentRoute);\n      }\n      if (_.isString(values)) {\n        values = {\n          content: values,\n          name: name\n        };\n      }\n      results.push(this.updateNode('meta', name, values));\n    }\n    return results;\n  };\n\n  IronRouterMeta.prototype.addLink = function(settings) {\n    var _settings, name, results, values;\n    _settings = this._prepare(settings);\n    results = [];\n    for (name in _settings) {\n      values = _settings[name];\n      if (_.isFunction(values)) {\n        values = values.call(this.currentRoute);\n      }\n      if (_.isString(values)) {\n        values = {\n          href: values,\n          rel: name\n        };\n      }\n      results.push(this.updateNode('link', name, values));\n    }\n    return results;\n  };\n\n  IronRouterMeta.prototype.addScript = function(settings) {\n    var _settings, name, results, values;\n    _settings = this._prepare(settings);\n    results = [];\n    for (name in _settings) {\n      values = _settings[name];\n      if (_.isFunction(values)) {\n        values = values.call(this.currentRoute);\n      }\n      if (_.isString(values)) {\n        values = {\n          src: values,\n          type: 'text/javascript'\n        };\n      }\n      results.push(this.updateNode('script', name, values, true));\n    }\n    return results;\n  };\n\n  return IronRouterMeta;\n\n})(IronRouterHelper);\n\nMeteor.startup(function() {\n  return new IronRouterMeta(Router);\n});\n","sourceMap":{"version":3,"file":"/iron-router-meta.coffee.js","sourceRoot":"","sources":["/packages/ostrio_iron-router-meta/iron-router-meta.coffee"],"names":[],"mappings":"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","sourcesContent":["class IronRouterMeta extends IronRouterHelper\n  constructor: (@router) -> \n    super @router\n    @router.onAfterAction =>\n      $('[data-link-name], [data-meta-name], [data-script-name]').remove()\n\n      tags = []\n      tags.push @router.options.meta if @router?.options?.meta\n      tags.push @currentController::['meta'] if @currentController?.prototype and _.has(@currentController::, 'meta')\n      tags.push @currentRoute.route.options.meta if @currentRoute?.route?.options?.meta\n      @addTag tags if tags.length\n\n      links = []\n      links.push @router.options.link if @router?.options?.link\n      links.push @currentController::['link'] if @currentController?.prototype and _.has(@currentController::, 'link')\n      links.push @currentRoute.route.options.link if @currentRoute?.route?.options?.link\n      @addLink links if links.length\n\n      scripts = []\n      scripts.push @router.options.script if @router?.options?.script\n      scripts.push @currentController::['script'] if @currentController?.prototype and _.has(@currentController::, 'script')\n      scripts.push @currentRoute.route.options.script if @currentRoute?.route?.options?.script\n      @addScript scripts if scripts.length\n\n  updateNode: (type, name, values, isClosing = false) ->\n    if $('head').has(type + '[data-' + type + '-name=\"' + name + '\"]')[0]\n      $(type + '[data-' + type + '-name=\"' + name + '\"]').remove() \n\n    if isClosing\n      element = $ '<' + type + ' data-' + type + '-name=\"' + name + '\"></' + type + '>'\n    else\n      element = $ '<' + type + ' data-' + type + '-name=\"' + name + '\" />'\n    for attrName, content of values\n      content = content.call @currentRoute if _.isFunction content\n      element.attr attrName, content if content\n    $('head').prepend element\n\n  _prepare: (settings) ->\n    _settings = {}\n    for set in settings\n      if _.isFunction set\n        _settings = _.extend(_settings, set.call(@currentRoute))\n      else if _.isObject set\n        _settings = _.extend(_settings, set)\n    return _settings\n\n  addTag: (settings) ->\n    _settings = @_prepare settings\n\n    for name, values of _settings\n      values = values.call @currentRoute if _.isFunction values\n      values = {content: values, name: name} if _.isString values\n      @updateNode 'meta', name, values\n\n  addLink: (settings) ->\n    _settings = @_prepare settings\n\n    for name, values of _settings\n      values = values.call @currentRoute if _.isFunction values\n      values = {href: values, rel: name} if _.isString values\n      @updateNode 'link', name, values\n\n  addScript: (settings) ->\n    _settings = @_prepare settings\n\n    for name, values of _settings\n      values = values.call @currentRoute if _.isFunction values\n      values = {src: values, type: 'text/javascript'} if _.isString values\n      @updateNode 'script', name, values, true\n\nMeteor.startup -> new IronRouterMeta Router"]}}